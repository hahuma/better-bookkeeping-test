generator client {
  provider = "prisma-client"
  output   = "./generated/client"
}

datasource db {
  provider = "postgresql"
}

enum WeightUnit {
  lbs
  kg
}

model User {
  id            String        @id @default(uuid())
  email         String        @unique
  name          String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  password      String
  weightUnit    WeightUnit    @default(lbs)
  workouts      Workout[]
  weightEntries WeightEntry[]
  movements     Movement[]
}

model Movement {
  id           String  @id @default(uuid())
  userId       String
  user         User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  name         String
  isBodyWeight Boolean @default(false)
  sets         Set[]

  @@index([userId])
}

model Workout {
  userId      String
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  id          String    @id @default(uuid())
  completedAt DateTime?
  sets        Set[]

  @@index([userId])
}

model Set {
  id         String   @id @default(uuid())
  workoutId  String
  workout    Workout  @relation(fields: [workoutId], references: [id], onDelete: Cascade)
  movementId String
  movement   Movement @relation(fields: [movementId], references: [id], onDelete: Restrict)
  reps       Int
  weight     Int

  @@index([workoutId])
  @@index([movementId])
}

model WeightEntry {
  id         String     @id @default(uuid())
  userId     String
  user       User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  weight     Float
  unit       WeightUnit @default(lbs)
  recordedAt DateTime   @default(now())
  note       String?

  @@index([userId, recordedAt])
}

model LoginAttempt {
  id        String   @id @default(uuid())
  email     String   @unique
  attempts  Int      @default(0)
  lockedAt  DateTime?
  updatedAt DateTime @updatedAt

  @@index([email])
}
